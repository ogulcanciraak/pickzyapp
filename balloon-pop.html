<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balon Patlatma - Pickzy</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 'title': ['Fredoka', 'sans-serif'], 'body': ['Quicksand', 'sans-serif'] },
                    animation: {
                        'breathe': 'breathe 2.5s ease-in-out infinite',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'popIn': 'popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'float': 'float 6s ease-in-out infinite',
                        'victoryJump': 'victoryJump 1s bounce infinite',
                        'pulse-glow': 'pulseGlow 2s infinite',
                        'slideDown': 'slideDown 0.4s ease-out',
                    },
                    keyframes: {
                        breathe: { '0%, 100%': { transform: 'scale(1)' }, '50%': { transform: 'scale(1.08)' } },
                        shake: { '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' }, '20%, 80%': { transform: 'translate3d(2px, 0, 0)' }, '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' }, '40%, 60%': { transform: 'translate3d(4px, 0, 0)' } },
                        popIn: { '0%': { transform: 'scale(0.5)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-15px)' } },
                        victoryJump: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-30px)' } },
                        pulseGlow: { '0%, 100%': { opacity: '0.6' }, '50%': { opacity: '1' } },
                        slideDown: { '0%': { transform: 'translate(-50%, -100%)', opacity: '0' }, '100%': { transform: 'translate(-50%, 0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>
    
    <style>
        body { 
            background-color: #0f172a;
            /* Derinlikli Arka Plan */
            background: radial-gradient(circle at 50% 0%, #1e293b 0%, #020617 80%);
            font-family: 'Quicksand', sans-serif;
            overflow: hidden;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
        
        .balloon-wrapper { transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
        
        .balloon-string {
            width: 2px; height: 60px; 
            background: linear-gradient(to bottom, rgba(255,255,255,0.5), transparent);
            margin: 0 auto; transform-origin: top center;
            animation: sway 3s ease-in-out infinite alternate;
        }
        @keyframes sway { from { transform: rotate(-5deg); } to { transform: rotate(5deg); } }

        /* Y√úZ ƒ∞FADELERƒ∞ */
        .eye { transition: all 0.3s; background: white; border-radius: 50%; position: absolute; }
        .pupil { transition: all 0.3s; background: black; border-radius: 50%; width: 40%; height: 40%; position: relative; top: 30%; left: 30%; }
        .mouth { transition: all 0.3s; position: absolute; background: #333; }
        .eyebrow { position: absolute; background: rgba(0,0,0,0.6); height: 3px; border-radius: 2px; transition: all 0.3s; }

        .scared .mouth { width: 16px !important; height: 18px !important; border-radius: 50% !important; border: 2px solid #333; background: #222; }
        .scared .eye { transform: scale(1.3); }
        .scared .eyebrow { top: 25% !important; transform: rotate(0deg) !important; }

        .winner-face .mouth { width: 30px !important; height: 15px !important; border-radius: 0 0 30px 30px !important; top: 65% !important; }
        .winner-face .eye { border-radius: 0 !important; width: 12px !important; height: 12px !important; background: transparent !important; border-top: 3px solid #333 !important; border-right: 3px solid #333 !important; transform: rotate(45deg) !important; }
        .winner-face .pupil { opacity: 0; }

        /* PARTƒ∞K√úLLER */
        .particle { position: absolute; width: 8px; height: 8px; border-radius: 50%; pointer-events: none; animation: explode 0.8s ease-out forwards; z-index: 50; }
        @keyframes explode { 0% { transform: translate(-50%, -50%) scale(1); opacity: 1; } 100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; } }

        /* YENƒ∞ GERƒ∞ SAYIM UI */
        .countdown-badge {
            position: absolute; 
            top: 100px; /* Header'ƒ±n altƒ±nda */
            left: 50%; 
            transform: translateX(-50%);
            z-index: 100;
            opacity: 0;
            transition: all 0.3s;
            pointer-events: none;
        }
        .countdown-badge.show { opacity: 1; animation: slideDown 0.3s ease-out; }
        
        /* ZEMƒ∞N & SAHNE */
        .stage-floor {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 30%;
            background: linear-gradient(to bottom, #0f172a 0%, #020617 100%);
            /* Izgara G√∂r√ºn√ºm√º */
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            perspective: 1000px;
            transform-origin: bottom;
            mask-image: linear-gradient(to bottom, transparent, black 20%);
        }
        
        .spotlight {
            position: absolute; top: -20%; left: 20%; width: 60%; height: 100%;
            background: radial-gradient(ellipse at center, rgba(255,255,255,0.05) 0%, transparent 70%);
            transform: rotate(-10deg);
            pointer-events: none;
        }
    </style>
</head>
<body class="min-h-screen text-white">

    <button onclick="location.href='index.html'" class="fixed top-6 left-6 z-50 bg-white/10 hover:bg-white/20 backdrop-blur-md text-white px-4 py-2 rounded-xl border border-white/10 transition-all font-bold text-sm flex items-center gap-2 group shadow-lg">
        <span class="group-hover:-translate-x-1 transition-transform">üè†</span> Ana Sayfa
    </button>

    <div id="setupScreen" class="flex items-center justify-center min-h-screen p-4">
        <div class="w-full max-w-4xl bg-slate-900/80 backdrop-blur-xl rounded-[2rem] shadow-2xl overflow-hidden border border-white/10 flex flex-col h-[85vh] animate-popIn">
            <div class="p-8 border-b border-white/10 text-center relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-r from-pink-500/20 via-purple-500/20 to-indigo-500/20 blur-xl"></div>
                <h1 class="font-title text-4xl md:text-5xl font-black relative z-10 flex items-center justify-center gap-4">
                    <span class="text-5xl animate-bounce">üéà</span> Balon Patlatma
                </h1>
                <p class="text-slate-400 font-bold mt-2 relative z-10">Gerilim dolu eleme oyunu!</p>
            </div>

            <div class="p-8 flex-1 flex flex-col gap-6 overflow-hidden">
                <div class="flex gap-3">
                    <input type="text" id="playerInput" placeholder="ƒ∞sim Girin..." 
                        class="flex-1 bg-white/5 border border-white/10 rounded-xl px-5 py-4 text-lg font-bold text-white placeholder:text-slate-500 focus:outline-none focus:border-pink-500 transition-colors">
                    <button onclick="addPlayer()" class="bg-pink-600 hover:bg-pink-500 text-white p-4 rounded-xl shadow-lg shadow-pink-600/30 transition-transform active:scale-95">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    </button>
                </div>

                <div class="flex gap-3">
                    <button onclick="loadRandomData()" class="flex-1 bg-white/5 hover:bg-white/10 py-3 rounded-xl font-bold text-slate-300 border border-white/5">üé≤ Rastgele</button>
                    <button onclick="clearAllPlayers()" class="flex-1 bg-red-500/10 hover:bg-red-500/20 text-red-400 py-3 rounded-xl font-bold border border-red-500/20">üóëÔ∏è Temizle</button>
                </div>

                <div class="bg-black/20 rounded-2xl p-4 flex-1 overflow-y-auto custom-scrollbar border border-white/5">
                    <div class="flex justify-between items-center mb-4 px-2">
                        <span class="text-xs font-bold text-slate-500 uppercase">Oyuncular</span>
                        <span id="countBadge" class="bg-white/10 px-2 py-1 rounded text-xs font-bold text-slate-300">0/20</span>
                    </div>
                    <div id="playerGrid" class="grid grid-cols-2 md:grid-cols-4 gap-3"></div>
                </div>

                <button id="startBtn" onclick="startGame()" disabled class="w-full bg-gradient-to-r from-pink-600 to-purple-600 text-white font-title text-2xl font-bold py-5 rounded-2xl shadow-xl shadow-purple-900/50 disabled:opacity-50 disabled:cursor-not-allowed transition-all hover:scale-[1.02] active:scale-[0.98]">
                    BA≈ûLAT
                </button>
            </div>
        </div>
    </div>

    <div id="gameScreen" class="hidden fixed inset-0 z-40">
        <div class="spotlight"></div>
        <div class="stage-floor"></div>

        <div class="absolute top-0 left-0 w-full p-6 flex justify-between items-center z-50">
            <div class="bg-slate-900/60 backdrop-blur-md px-5 py-3 rounded-2xl border border-white/10 flex items-center gap-4 shadow-xl">
                <div class="flex flex-col">
                    <span class="text-xs text-slate-400 font-bold uppercase tracking-wider">Kalanlar</span>
                    <span class="font-black text-2xl text-white leading-none" id="remainingCount">0</span>
                </div>
                <div class="h-8 w-[1px] bg-white/10"></div>
                <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse-glow shadow-[0_0_10px_#22c55e]"></div>
            </div>
            
            <button onclick="resetGame()" class="bg-slate-900/60 hover:bg-slate-800/80 backdrop-blur-md p-3 rounded-xl text-slate-400 hover:text-white transition-colors border border-white/5">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
            </button>
        </div>

        <div id="countdownBadge" class="countdown-badge">
            <div class="bg-slate-900/90 backdrop-blur-xl border border-white/20 px-8 py-4 rounded-2xl shadow-2xl flex items-center gap-4 transform scale-110">
                <span class="text-slate-400 font-bold uppercase text-sm tracking-widest">Patlamaya</span>
                <div class="w-[1px] h-6 bg-white/20"></div>
                <span id="countdownText" class="font-black text-4xl text-pink-500 w-8 text-center font-title">3</span>
            </div>
        </div>

        <div id="balloonContainer" class="w-full h-full flex flex-wrap items-center justify-center content-center gap-x-12 gap-y-16 p-8 overflow-hidden relative z-10 pb-32">
            </div>
        
        <div id="flashOverlay" class="absolute inset-0 bg-white pointer-events-none opacity-0 transition-opacity duration-100 z-[60]"></div>
    </div>

    <div id="winnerModal" class="fixed inset-0 z-[70] hidden bg-black/80 backdrop-blur-md items-center justify-center p-4">
        <div class="bg-slate-800 border border-white/10 rounded-3xl p-8 text-center max-w-sm w-full shadow-2xl animate-popIn relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-b from-purple-500/10 to-transparent"></div>
            <div class="relative z-10">
                <div class="text-7xl mb-4 animate-bounce">üëë</div>
                <h2 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-2">HAYATTA KALAN</h2>
                <div id="winnerName" class="text-4xl font-black text-white mb-8"></div>
                <button onclick="resetGame()" class="w-full bg-pink-600 hover:bg-pink-500 text-white font-bold py-4 rounded-xl shadow-lg transition-all">TEKRAR OYNA</button>
            </div>
        </div>
    </div>

    <script>
        const BALLOON_COLORS = [
            { bg: '#ef4444', shadow: '#991b1b' }, { bg: '#3b82f6', shadow: '#1e40af' },
            { bg: '#22c55e', shadow: '#15803d' }, { bg: '#eab308', shadow: '#a16207' },
            { bg: '#a855f7', shadow: '#6b21a8' }, { bg: '#ec4899', shadow: '#9d174d' },
            { bg: '#06b6d4', shadow: '#155e75' }, { bg: '#f97316', shadow: '#c2410c' }
        ];

        let players = [];
        let activePlayers = [];
        let gameLoopTimeout = null;
        let countdownInterval = null;

        // --- SETUP ---
        function addPlayer() {
            const input = document.getElementById('playerInput');
            const name = input.value.trim();
            if(!name) return;
            if(players.length >= 20) return alert('Maksimum 20 oyuncu!');
            
            players.push({ 
                id: Date.now(), 
                name, 
                color: BALLOON_COLORS[players.length % BALLOON_COLORS.length]
            });
            input.value = '';
            renderPlayers();
        }

        function removePlayer(id) {
            players = players.filter(p => p.id !== id);
            renderPlayers();
        }

        function renderPlayers() {
            const grid = document.getElementById('playerGrid');
            const btn = document.getElementById('startBtn');
            document.getElementById('countBadge').innerText = `${players.length}/20`;
            btn.disabled = players.length < 2;

            grid.innerHTML = players.map(p => `
                <div class="bg-white/5 border border-white/5 p-3 rounded-xl flex items-center gap-3 animate-popIn">
                    <div class="w-4 h-4 rounded-full shadow-[0_0_8px]" style="background:${p.color.bg}"></div>
                    <span class="font-bold text-slate-200 truncate flex-1">${p.name}</span>
                    <button onclick="removePlayer(${p.id})" class="text-slate-500 hover:text-red-400">‚úï</button>
                </div>
            `).join('');
        }

        function loadRandomData() {
            const names = ['Ahmet', 'Ay≈üe', 'Mehmet', 'Fatma', 'Ali', 'Zeynep', 'Can', 'Elif', 'Mert', 'Selin'];
            players = [];
            names.forEach((name, i) => {
                players.push({
                    id: Date.now() + Math.random(),
                    name,
                    color: BALLOON_COLORS[Math.floor(Math.random() * BALLOON_COLORS.length)]
                });
            });
            renderPlayers();
        }
        function clearAllPlayers() { players = []; renderPlayers(); }

        // --- OYUN ---
        function startGame() {
            document.getElementById('setupScreen').classList.add('hidden'); // Setup'ƒ± gizle
            document.getElementById('gameScreen').classList.remove('hidden'); // Oyunu g√∂ster
            activePlayers = [...players];
            renderBalloons();
            
            // ƒ∞lk d√∂ng√º
            gameLoopTimeout = setTimeout(startEliminationCycle, 1500);
        }

        function renderBalloons() {
            const container = document.getElementById('balloonContainer');
            document.getElementById('remainingCount').innerText = activePlayers.length;
            
            container.innerHTML = players.map(p => {
                return `
                    <div id="balloon-wrapper-${p.id}" class="balloon-wrapper relative flex flex-col items-center justify-center animate-float" style="width: 120px; height: 180px; animation-duration: ${4 + Math.random() * 3}s; animation-delay: -${Math.random() * 5}s;">
                        
                        <div id="balloon-${p.id}" class="balloon-body w-28 h-36 md:w-32 md:h-40 relative flex flex-col items-center justify-center shadow-lg transition-transform duration-300 animate-breathe"
                             style="border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), ${p.color.bg}); box-shadow: 0 10px 40px -5px ${p.color.shadow};">
                            
                            <div class="face-features w-full h-full relative" id="face-${p.id}">
                                <div class="eye" style="top: 35%; left: 25%; width: 12px; height: 16px;">
                                    <div class="pupil"></div>
                                </div>
                                <div class="eye" style="top: 35%; right: 25%; width: 12px; height: 16px;">
                                    <div class="pupil"></div>
                                </div>
                                
                                <div class="eyebrow" style="top: 28%; left: 22%; width: 16px; transform: rotate(-10deg);"></div>
                                <div class="eyebrow" style="top: 28%; right: 22%; width: 16px; transform: rotate(10deg);"></div>

                                <div class="mouth" style="top: 65%; left: 50%; transform: translateX(-50%); width: 16px; height: 6px; border-radius: 0 0 50% 50%;"></div>
                            </div>

                            <div class="absolute top-[15%] left-[18%] w-5 h-10 bg-white/40 rounded-[50%] rotate-[-45deg] z-10"></div>
                            
                            <span class="absolute -bottom-8 font-black text-white/90 drop-shadow-md text-lg bg-black/30 px-2 rounded-md z-20 whitespace-nowrap overflow-visible">${p.name}</span>
                            
                            <div class="absolute -bottom-1 w-4 h-3 rounded-sm" style="background: ${p.color.shadow}"></div>
                        </div>
                        <div class="balloon-string"></div>
                    </div>
                `;
            }).join('');
        }

        function startEliminationCycle() {
            if (activePlayers.length <= 1) {
                gameLoopTimeout = setTimeout(() => celebrateWinner(activePlayers[0]), 500);
                return;
            }
            
            resetFaces();

            if (countdownInterval) clearInterval(countdownInterval);

            runCountdown(3, () => {
                eliminateRandomPlayer();
            });
        }

        function runCountdown(seconds, callback) {
            const badge = document.getElementById('countdownBadge');
            const text = document.getElementById('countdownText');
            
            badge.classList.add('show');
            let counter = seconds;

            text.innerText = counter;
            
            countdownInterval = setInterval(() => {
                counter--;
                
                if (counter > 0) {
                     text.innerText = counter;
                     // Efekt
                     text.style.transform = 'scale(1.5)';
                     setTimeout(() => text.style.transform = 'scale(1)', 100);
                } else {
                    clearInterval(countdownInterval);
                    text.innerText = "!";
                    setTimeout(() => {
                        badge.classList.remove('show');
                        callback();
                    }, 400);
                }
            }, 1000);
        }

        function eliminateRandomPlayer() {
            const victimIndex = Math.floor(Math.random() * activePlayers.length);
            const victim = activePlayers[victimIndex];
            
            const wrapperEl = document.getElementById(`balloon-wrapper-${victim.id}`);
            const balloonEl = document.getElementById(`balloon-${victim.id}`);
            
            if (balloonEl && wrapperEl) {
                createExplosion(balloonEl, victim.color.bg);
                balloonEl.style.transform = "scale(1.4)";
                balloonEl.style.opacity = "0";
                
                // Ekran Sallantƒ±sƒ±
                document.body.classList.add('animate-shake');
                setTimeout(() => document.body.classList.remove('animate-shake'), 500);

                makeSurvivorsLookAt(balloonEl);
                
                setTimeout(() => {
                    wrapperEl.style.width = '0px';
                    wrapperEl.style.margin = '0px';
                    wrapperEl.style.opacity = '0';
                    wrapperEl.style.transform = 'scale(0)';
                }, 200);
            }

            activePlayers.splice(victimIndex, 1);
            document.getElementById('remainingCount').innerText = activePlayers.length;

            gameLoopTimeout = setTimeout(() => {
                if (wrapperEl) wrapperEl.remove();
                startEliminationCycle(); 
            }, 800);
        }

        function makeSurvivorsLookAt(victimEl) {
            const victimRect = victimEl.getBoundingClientRect();
            const victimX = victimRect.left + victimRect.width / 2;
            const victimY = victimRect.top + victimRect.height / 2;

            activePlayers.forEach(p => {
                const survivorEl = document.getElementById(`balloon-${p.id}`);
                const faceEl = document.getElementById(`face-${p.id}`);
                if (!survivorEl || !faceEl) return;

                const survivorRect = survivorEl.getBoundingClientRect();
                const survivorX = survivorRect.left + survivorRect.width / 2;
                const survivorY = survivorRect.top + survivorRect.height / 2;

                const angle = Math.atan2(victimY - survivorY, victimX - survivorX);
                const distance = 4;

                const pupils = survivorEl.querySelectorAll('.pupil');
                pupils.forEach(pupil => {
                    pupil.style.transform = `translate(${Math.cos(angle)*distance}px, ${Math.sin(angle)*distance}px)`;
                });

                faceEl.classList.add('scared');
            });
        }

        function resetFaces() {
            const faces = document.querySelectorAll('.face-features');
            faces.forEach(face => {
                face.classList.remove('scared');
                const pupils = face.querySelectorAll('.pupil');
                pupils.forEach(p => p.style.transform = 'translate(0, 0)');
            });
        }

        function celebrateWinner(winner) {
            const balloonEl = document.getElementById(`balloon-${winner.id}`);
            const faceEl = document.getElementById(`face-${winner.id}`);
            
            if(balloonEl && faceEl) {
                resetFaces();
                faceEl.classList.add('winner-face');
                balloonEl.classList.remove('animate-float');
                balloonEl.classList.add('animate-victoryJump');
                
                createExplosion(balloonEl, '#FFD700');
                createExplosion(balloonEl, '#FFF');
            }

            gameLoopTimeout = setTimeout(() => showWinner(winner), 2000);
        }

        function createExplosion(element, color) {
            const rect = element.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                particle.style.background = color;
                particle.style.left = centerX + 'px';
                particle.style.top = centerY + 'px';
                
                const angle = Math.random() * Math.PI * 2;
                const velocity = 50 + Math.random() * 150;
                const tx = Math.cos(angle) * velocity + 'px';
                const ty = Math.sin(angle) * velocity + 'px';
                
                particle.style.setProperty('--tx', tx);
                particle.style.setProperty('--ty', ty);
                
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 800);
            }
        }

        function showWinner(winner) {
            const modal = document.getElementById('winnerModal');
            document.getElementById('winnerName').innerText = winner ? winner.name : 'Kimse';
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function resetGame() {
            clearTimeout(gameLoopTimeout);
            clearInterval(countdownInterval);
            
            document.getElementById('countdownBadge').classList.remove('show');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('winnerModal').classList.add('hidden');
            document.getElementById('winnerModal').classList.remove('flex');
            document.getElementById('setupScreen').classList.remove('hidden');
        }

        document.getElementById('playerInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addPlayer();
        });
    </script>
</body>
</html>